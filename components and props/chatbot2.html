<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="container"></div>
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
        //we use state to save the data that changes over time
        function ChatInput({chatMessages,setChatMessages}){
            //inputText is the initial data
            const [inputText,setInputText]= React.useState('');
                
            function saveInputText(event){
                setInputText(event.target.value);
                if(event.key === 'Enter'){
                    sendMessage();
                }
                
            }
            async function sendMessage(){
                //we are in ChatInput component and not in ChatMessages component which is why we can't access the chatMessages/ so we use lifiting the state up
                const newChatMessages =[
                        ...chatMessages,
                        {
                            message: inputText,
                            sender: 'user',
                            id: crypto.randomUUID()

                        }
                    
                    ];
                    setChatMessages(newChatMessages);

                    const response = await Chatbot.getResponseAsync(inputText);
                    setChatMessages ([
                        ...newChatMessages,
                        {
                            message: response,
                            sender:'robot',
                            id: crypto.randomUUID()
                        }
                    ]);
                    setInputText('');
                }      
                return(
                <>
                <input
                 placeholder="send message to chatbot" 
                size = "30"
                onChange ={saveInputText}
                onKeyDown={saveInputText}
                value = {inputText}
                />
                <button 
                onClick={sendMessage}
                >Send</button>
                </>
            );
                    
              }
        function ChatMessage({message,sender}){
            return(
                <div>
                    {sender === 'robot' &&(
                        <img src="robot.png" width="50"/>
                    )}
                    {message}
                    {sender === 'user' &&(
                        <img src="user.png" width="50" />
                    )}
                </div>
            )
        }
        
            function ChatMessages({ chatMessages }){
                 return(
                    <>
                        {chatMessages.map((chatMessages)=>{
                         return(
                            <ChatMessage
                            message = {chatMessages.message}
                            sender = {chatMessages.sender} 
                            key = {chatMessages.id}
                            />
                            );
                        })}
                     </>
                    );
        }
        
        /* so we save the data in useState and react useState returns the data in array. array[0] is the current data. and the updated data is in next. let's say array[1] which is the function that lets us updat ethe data*/
        
           // const array =React.useState instead of this we can directly destruct
               
          

            //const chatMessages= array[0];
            //const setChatMessages= array[1]; instead of this we can write
            //const[chatMessages,setChatMessages]=array;

/* the function is used to update the data. which starts with set foreg here set and then data name ChatMessages.*/
                
/*however if we use function. react will not update the html so we use state.it's used to update the html*/
              
                    /*chatmessage.push({
                        message : 'thank you',
                        sender:'user',
                        id: crypto.randomUUID()
                    });

                    console.log(chatmessage);
                    in react we shouldn't update the data directly but rather use the copy. using spread operator ...*/
                
               
        function App(){
             const [chatMessages, setChatMessages] =React.useState([
                    {
                        message: 'hello chatbot',
                        sender :'user',
                        id:'id1'
                    },
                    {
                        message:'hello ! how can i help you',
                        sender:'robot',
                        id:'id2'
                    },
                    {
                        message:'can you get me todays date?',
                        sender:'user',
                        id:'id3'
                    },
                    {
                        message:'Today is December 1',
                        sender:'robot',
                        id:'id4'

                    }]);
                
            return(
                <>
                <ChatInput 
                chatMessages = {chatMessages}
                setChatMessages = {setChatMessages}
                
                />
                <ChatMessages
                chatMessages ={chatMessages} />
                </>
            )
        }
        const container = document.querySelector('.container');
        ReactDOM.createRoot(container).render(<App />)
    </script>
</body>
</html>
