<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <style>
        .body{
            font-family: Arial;
            margin-top: 0px;
            margin-bottom: 0px;
        }
        .sendbtn{
            background-color: rgb(25,135,84);
            color: white;
            padding: 12px 20px;
            margin-left: 10px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            cursor: pointer;
        }
        .chat-input{
            padding: 12px 15px;
            border-radius: 10px;
            border-width: 1px;
            font-size: 15px;

            flex-grow: 1;
        }
        .chat-input-container{
            display: flex;
            margin-bottom: 20px;
        }
        .app-container{
            margin-left: auto;
            margin-right: auto;
            max-width: 600px;
            height: 100vh;
            display: flex;
            flex-direction: column;

        }
        .chat-message-user{
            display: flex;
            justify-content: end;
            align-items: start;
        }
        .chat-message-robot{
            display: flex;
            align-items: start;
        }
        .chat-message-text{
            background-color: rgb(238, 238, 238);
            padding: 15px 20px;
            border-radius: 10px;
            margin-right: 10px;
            margin-left: 10px;
            margin-bottom: 20px;
            max-width: 300px;
        }
        .chat-message-profile{
            width: 45px;
        }
        .chat-messages-container{
            flex-grow: 1;
            margin-top: 20px;
            overflow: scroll;
            scrollbar-width: none
        }
    </style>
</head>
<body>
    <div class="container"></div>
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
     <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
        function ChatInput({chatMsg,setChatMsg}){
            const [inputText,setInputText]=React.useState('');
            function saveInputText(e){
                setInputText(e.target.value);
                if(e.key === 'Enter'){
                    sendMessage();
                }
                if(e.key === 'Escape'){
                    setInputText('');
                }
            }
           async function sendMessage(){
                const newChatMessages = [
                    ...chatMsg,
                    {
                        message: inputText,
                        sender: 'user',
                        id: crypto.randomUUID()
                    }
                ]
                setChatMsg(newChatMessages);
                const response = await Chatbot.getResponseAsync(inputText);
                setChatMsg([
                    ...newChatMessages,
                    {
                        message : response,
                        sender: 'robot',
                        id: crypto.randomUUID()
                    }
                ])

                setInputText('');


            }
            return(
                <div className="chat-input-container">
                <input 
                placeholder="send message to chatbot"
                size="30"
                onChange={saveInputText}
                onKeyDown={saveInputText}
                value = {inputText}
                className="chat-input"
                />
                <button
                 className="sendbtn"
                  onClick={sendMessage}
                  >Send</button>
                </div>
            )
        }
        function ChatMessage({message,sender}){
            return(
                <div className={
                sender === 'user' 
                ? 'chat-message-user' 
                : 'chat-message-robot'
                 }> 
                {sender === 'robot' && (
                    <img src="robot.png" 
                    className="chat-message-profile"/>
                )}
                <div className="chat-message-text">
                    {message}
                </div>
                {sender === 'user' && (
                    <img src="user.png" 
                    className="chat-message-profile"/>
                )}
                </div>
            )
        }
        function ChatMessages({
            chatMsg}){
                 //now we want to use this effect when a message is created but inorder to get the div that has the Chatmessage we can't use DOM in react so use a another hook called useRef
                // ref helps us save a html element.
               const chatMessagesRef =  React.useRef(null);
            React.useEffect(()=>{

           const containerElem = chatMessagesRef.current;
           if(containerElem){
            containerElem.scrollTop = containerElem.scrollHeight;
           }
            },[chatMsg]); //[] defines when the effect runs. it is called Dependency array.
            
            return (
                <div className="chat-messages-container" ref={chatMessagesRef}>
                {chatMsg.map((chat)=>{
                     return(
                         <ChatMessage
                        message = {chat.message}
                        sender= {chat.sender}
                        key= {chat.id}
                        />
                    )
                })}
                </div>
            );
            //.map() lets us through the each value of array and convert it into a new value
        }
        function App(){
             const [chatMsg,setChatMsg]=React.useState([
                {
                    message:"Hi",
                    sender:'user',
                    id:'id1'
                },
                {
                    message:"Hello, How can i help",
                    sender:'robot',
                    id:'id2'

                },
                {
                    message:"Can you get me today's date",
                    sender:'user',
                    id:'id3'

                },
                {
                    message:"Sure,Today is December 2",
                    sender:'robot',
                    id:'id4'
                }
            ]);
            return(
                <div className="app-container">
                <ChatMessages
                chatMsg={chatMsg}
                 />
                 <ChatInput
                chatMsg={chatMsg}
                setChatMsg={setChatMsg} />
                </div>

            )
        }
        const container = document.querySelector('.container');
        ReactDOM.createRoot(container).render(<App />);
    </script>

</body>
</html>
