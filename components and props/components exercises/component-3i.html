<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="container"></div>
     <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
     <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
        function InputText({chatMessage,setChatMessage}){
            const [input,setInput]= React.useState('');
            function saveInputText(e){
                setInput(e.target.value);
                if(e.key === 'Enter'){
                    sendMessage();
                }
                if(e.key === 'Escape'){
                    setInput('');
                }

            }
           async function sendMessage(){
                const newChatMessage = [
                    ...chatMessage,{
                        message:input,
                        sender: 'user',
                        id: crypto.randomUUID()
                    }
                ]
                setChatMessage(newChatMessage);
                const response = await Chatbot.getResponseAsync(input);
                setChatMessage([
                    ...newChatMessage,{
                        message: response,
                        sender: 'robot',
                        id: crypto.randomUUID()

                    }
                ])

            }
            
            return(
                <>
                <input placeholder="send message to bot"
                onChange={saveInputText}
                onKeyDown = {saveInputText}
                />
                <button onClick={sendMessage}>Send</button>
                </>
            )
        }
        function ChatMsg({message,sender}){
            return(
                <div>
                {sender === 'robot' &&( <img src="robot.png"  />)}
                {message}
                {sender === 'user' && (<img src="user.png"/>)}
                </div>
            )
        }
        function ChatMsgs({chatMessage}){
            return(
                chatMessage.map((chat)=>{
                    return(
                        <ChatMsg
                        message = {chat.message}
                        sender ={chat.sender}
                        id = {chat.id}
                        />
                    )

                })

            )

        }
        function App(){
            const [chatMessage,setChatMessage] = React.useState([
                {
                    message: 'hi',
                    sender: 'user',
                    id: 'id1'
                },
                {
                    message: 'hello, how are you?',
                    sender: 'robot',
                    id: 'id2'
                },
                {
                    message: 'what date is today',
                    sender: 'user',
                    id:'id3'

                },
                {
                    message: 'today is December 2',
                    sender: 'robot',
                    id:'id4'
                }
            ])
            return(
                <>
                <InputText
                chatMessage = {chatMessage}
                setChatMessage = {setChatMessage}
                 />
                <ChatMsgs
                chatMessage = {chatMessage}
                 />
                </>

            )
        }

        const container = document.querySelector('.container');
        ReactDOM.createRoot(container).render(<App />);
    </script>
</body>
</html>